<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="NEURODONE">
  <meta name="description" content="ADHD-friendly task manager that works with your brain, not against it">
  
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.svg">
  <link rel="icon" type="image/svg+xml" href="icon-192.svg">
  
  <script>
    // Register Service Worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('NEURODONE: SW registered'))
          .catch(err => console.log('NEURODONE: SW registration failed', err));
      });
    }
  </script>
  
  <title>NEURODONE</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    :root {
      --bg-deep: #0d0d14;
      --bg-main: #13131f;
      --bg-card: #1a1a2e;
      --bg-elevated: #242440;
      --accent-primary: #7c5cff;
      --accent-glow: #9d7fff;
      --accent-success: #4ade80;
      --accent-warning: #fbbf24;
      --accent-danger: #f87171;
      --text-primary: #f8f8fc;
      --text-secondary: #a0a0b8;
      --text-muted: #6b6b80;
      --border-subtle: rgba(255, 255, 255, 0.06);
      --border-active: rgba(124, 92, 255, 0.3);
      --shadow-soft: 0 4px 24px rgba(0, 0, 0, 0.4);
      --shadow-glow: 0 0 40px rgba(124, 92, 255, 0.15);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 20px;
      --radius-xl: 28px;
      --font-main: 'Outfit', -apple-system, sans-serif;
      --font-mono: 'Space Mono', monospace;
    }
    
    html, body, #root {
      height: 100%;
      width: 100%;
      overflow: hidden;
    }
    
    body {
      font-family: var(--font-main);
      background: var(--bg-deep);
      color: var(--text-primary);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }
    
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background: var(--bg-elevated);
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel" data-type="module">
    const { useState, useEffect, useRef, useCallback, createContext, useContext } = React;

    // Generate unique IDs
    const generateId = () => Math.random().toString(36).substr(2, 9);
    
    // Date utilities
    const formatDate = (date) => {
      const d = new Date(date);
      return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
    };
    
    const isToday = (date) => {
      const today = new Date();
      const d = new Date(date);
      return d.toDateString() === today.toDateString();
    };
    
    const isTomorrow = (date) => {
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      const d = new Date(date);
      return d.toDateString() === tomorrow.toDateString();
    };
    
    const getRelativeDay = (date) => {
      if (isToday(date)) return 'Today';
      if (isTomorrow(date)) return 'Tomorrow';
      return formatDate(date);
    };

    // AI Task Parsing (Simulated - integrate Claude API in production)
    const parseTaskWithAI = async (voiceText) => {
      await new Promise(r => setTimeout(r, 800));
      
      const text = voiceText.toLowerCase();
      
      let project = 'Inbox';
      const forMatch = text.match(/for\s+([a-zA-Z0-9\s]+?)(?:\s+by|\s+due|\s+tomorrow|\s+today|$)/i);
      const projectMatch = text.match(/([a-zA-Z0-9]+)\s+project/i);
      if (forMatch) project = forMatch[1].trim();
      else if (projectMatch) project = projectMatch[1].trim();
      
      let deadline = new Date();
      deadline.setHours(17, 0, 0, 0);
      
      if (text.includes('tomorrow')) {
        deadline.setDate(deadline.getDate() + 1);
      } else if (text.includes('next week')) {
        deadline.setDate(deadline.getDate() + 7);
      } else if (text.includes('friday')) {
        const daysUntilFriday = (5 - deadline.getDay() + 7) % 7 || 7;
        deadline.setDate(deadline.getDate() + daysUntilFriday);
      } else if (text.includes('monday')) {
        const daysUntilMonday = (1 - deadline.getDay() + 7) % 7 || 7;
        deadline.setDate(deadline.getDate() + daysUntilMonday);
      }
      
      let taskName = voiceText
        .replace(/for\s+[a-zA-Z0-9\s]+?\s+(by|due)/gi, '')
        .replace(/by\s+(tomorrow|friday|monday|next week|today)/gi, '')
        .replace(/due\s+(tomorrow|friday|monday|next week|today)/gi, '')
        .replace(/\s+project/gi, '')
        .trim();
      
      if (taskName.toLowerCase().startsWith('i need to ')) {
        taskName = taskName.substring(10);
      }
      if (taskName.toLowerCase().startsWith('need to ')) {
        taskName = taskName.substring(8);
      }
      
      taskName = taskName.charAt(0).toUpperCase() + taskName.slice(1);
      
      const chunks = generateTaskChunks(taskName);
      
      return {
        id: generateId(),
        name: taskName,
        project: project.charAt(0).toUpperCase() + project.slice(1),
        deadline: deadline.toISOString(),
        chunks: chunks,
        completed: false,
        createdAt: new Date().toISOString(),
      };
    };
    
    const generateTaskChunks = (taskName) => {
      const name = taskName.toLowerCase();
      
      if (name.includes('presentation') || name.includes('deck') || name.includes('pitch')) {
        return [
          { id: generateId(), name: 'Brain dump ideas (5 min)', completed: false, duration: 5 },
          { id: generateId(), name: 'Create outline structure', completed: false, duration: 15 },
          { id: generateId(), name: 'Draft key slides', completed: false, duration: 30 },
          { id: generateId(), name: 'Add visuals & polish', completed: false, duration: 20 },
          { id: generateId(), name: 'Quick review & done!', completed: false, duration: 10 },
        ];
      }
      
      if (name.includes('email') || name.includes('write') || name.includes('draft')) {
        return [
          { id: generateId(), name: 'Jot down main points', completed: false, duration: 5 },
          { id: generateId(), name: 'Write first draft (ugly is fine!)', completed: false, duration: 15 },
          { id: generateId(), name: 'Quick polish & send', completed: false, duration: 5 },
        ];
      }
      
      if (name.includes('meeting') || name.includes('call')) {
        return [
          { id: generateId(), name: 'Note 3 things to discuss', completed: false, duration: 5 },
          { id: generateId(), name: 'Prep any materials needed', completed: false, duration: 10 },
          { id: generateId(), name: 'Set reminder 10 min before', completed: false, duration: 2 },
        ];
      }
      
      if (name.includes('research') || name.includes('analyze')) {
        return [
          { id: generateId(), name: "Define what you're looking for", completed: false, duration: 5 },
          { id: generateId(), name: 'Quick scan sources (set timer!)', completed: false, duration: 20 },
          { id: generateId(), name: 'Note key findings', completed: false, duration: 10 },
          { id: generateId(), name: 'Summarize insights', completed: false, duration: 10 },
        ];
      }
      
      return [
        { id: generateId(), name: 'Get started (just 2 min)', completed: false, duration: 2 },
        { id: generateId(), name: 'Make progress', completed: false, duration: 15 },
        { id: generateId(), name: 'Wrap it up', completed: false, duration: 10 },
      ];
    };

    // Icons
    const Icons = {
      Mic: () => (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
          <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
          <line x1="12" x2="12" y1="19" y2="22"/>
        </svg>
      ),
      MicOff: () => (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <line x1="2" x2="22" y1="2" y2="22"/>
          <path d="M18.89 13.23A7.12 7.12 0 0 0 19 12v-2"/>
          <path d="M5 10v2a7 7 0 0 0 12 5"/>
          <path d="M15 9.34V5a3 3 0 0 0-5.68-1.33"/>
          <path d="M9 9v3a3 3 0 0 0 5.12 2.12"/>
          <line x1="12" x2="12" y1="19" y2="22"/>
        </svg>
      ),
      Plus: () => (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
      ),
      Check: () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round">
          <polyline points="20 6 9 17 4 12"/>
        </svg>
      ),
      Calendar: () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
          <line x1="16" x2="16" y1="2" y2="6"/>
          <line x1="8" x2="8" y1="2" y2="6"/>
          <line x1="3" x2="21" y1="10" y2="10"/>
        </svg>
      ),
      List: () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <line x1="8" x2="21" y1="6" y2="6"/>
          <line x1="8" x2="21" y1="12" y2="12"/>
          <line x1="8" x2="21" y1="18" y2="18"/>
          <line x1="3" x2="3.01" y1="6" y2="6"/>
          <line x1="3" x2="3.01" y1="12" y2="12"/>
          <line x1="3" x2="3.01" y1="18" y2="18"/>
        </svg>
      ),
      Folder: () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/>
        </svg>
      ),
      Clock: () => (
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
      ),
      Sparkles: () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
          <path d="M5 3v4"/>
          <path d="M19 17v4"/>
          <path d="M3 5h4"/>
          <path d="M17 19h4"/>
        </svg>
      ),
      ChevronRight: () => (
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="m9 18 6-6-6-6"/>
        </svg>
      ),
      X: () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M18 6 6 18"/>
          <path d="m6 6 12 12"/>
        </svg>
      ),
      Brain: () => (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/>
          <path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/>
        </svg>
      ),
    };

    // Celebration animation
    const Celebration = ({ show, onComplete }) => {
      useEffect(() => {
        if (show) {
          const timer = setTimeout(onComplete, 2000);
          return () => clearTimeout(timer);
        }
      }, [show, onComplete]);
      
      if (!show) return null;
      
      return (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          background: 'rgba(13, 13, 20, 0.9)',
          zIndex: 1000,
          animation: 'fadeIn 0.3s ease',
        }}>
          <div style={{
            textAlign: 'center',
            animation: 'popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
          }}>
            <div style={{ fontSize: '64px', marginBottom: '16px' }}>ðŸŽ‰</div>
            <div style={{ fontSize: '24px', fontWeight: '600', color: 'var(--accent-success)' }}>
              Task Complete!
            </div>
            <div style={{ fontSize: '14px', color: 'var(--text-secondary)', marginTop: '8px' }}>
              You're doing amazing
            </div>
          </div>
        </div>
      );
    };
    
    // Voice Recording Button
    const VoiceButton = ({ onTranscript }) => {
      const [isRecording, setIsRecording] = useState(false);
      const [isProcessing, setIsProcessing] = useState(false);
      const recognitionRef = useRef(null);
      
      useEffect(() => {
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
          const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
          recognitionRef.current = new SpeechRecognition();
          recognitionRef.current.continuous = false;
          recognitionRef.current.interimResults = false;
          recognitionRef.current.lang = 'en-US';
          
          recognitionRef.current.onresult = async (event) => {
            const transcript = event.results[0][0].transcript;
            setIsRecording(false);
            setIsProcessing(true);
            
            try {
              const parsedTask = await parseTaskWithAI(transcript);
              onTranscript(parsedTask);
            } catch (error) {
              console.error('Error parsing task:', error);
            }
            
            setIsProcessing(false);
          };
          
          recognitionRef.current.onerror = () => {
            setIsRecording(false);
            setIsProcessing(false);
          };
          
          recognitionRef.current.onend = () => {
            setIsRecording(false);
          };
        }
      }, [onTranscript]);
      
      const toggleRecording = () => {
        if (!recognitionRef.current) {
          alert('Speech recognition not supported. Try Chrome or Safari.');
          return;
        }
        
        if (isRecording) {
          recognitionRef.current.stop();
          setIsRecording(false);
        } else {
          recognitionRef.current.start();
          setIsRecording(true);
        }
      };
      
      return (
        <button
          onClick={toggleRecording}
          disabled={isProcessing}
          style={{
            width: '72px',
            height: '72px',
            borderRadius: '50%',
            border: 'none',
            background: isRecording 
              ? 'linear-gradient(135deg, #f87171, #ef4444)' 
              : 'linear-gradient(135deg, var(--accent-primary), var(--accent-glow))',
            color: 'white',
            cursor: isProcessing ? 'wait' : 'pointer',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            boxShadow: isRecording 
              ? '0 0 40px rgba(248, 113, 113, 0.5)' 
              : 'var(--shadow-glow)',
            transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
            transform: isRecording ? 'scale(1.1)' : 'scale(1)',
            animation: isRecording ? 'pulse 1.5s infinite' : 'none',
          }}
        >
          {isProcessing ? (
            <div style={{
              width: '24px',
              height: '24px',
              border: '3px solid rgba(255,255,255,0.3)',
              borderTopColor: 'white',
              borderRadius: '50%',
              animation: 'spin 0.8s linear infinite',
            }} />
          ) : isRecording ? (
            <Icons.MicOff />
          ) : (
            <Icons.Mic />
          )}
        </button>
      );
    };
    
    // Task Chunk Item
    const ChunkItem = ({ chunk, onToggle }) => {
      return (
        <div
          onClick={() => onToggle(chunk.id)}
          style={{
            display: 'flex',
            alignItems: 'center',
            gap: '12px',
            padding: '12px',
            background: chunk.completed ? 'rgba(74, 222, 128, 0.1)' : 'var(--bg-main)',
            borderRadius: 'var(--radius-sm)',
            cursor: 'pointer',
            transition: 'all 0.2s ease',
            opacity: chunk.completed ? 0.7 : 1,
          }}
        >
          <div style={{
            width: '24px',
            height: '24px',
            borderRadius: '50%',
            border: chunk.completed ? 'none' : '2px solid var(--text-muted)',
            background: chunk.completed ? 'var(--accent-success)' : 'transparent',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            flexShrink: 0,
            transition: 'all 0.2s ease',
          }}>
            {chunk.completed && <Icons.Check />}
          </div>
          <div style={{ flex: 1 }}>
            <div style={{
              fontSize: '14px',
              color: chunk.completed ? 'var(--text-muted)' : 'var(--text-primary)',
              textDecoration: chunk.completed ? 'line-through' : 'none',
            }}>
              {chunk.name}
            </div>
          </div>
          <div style={{
            fontSize: '12px',
            color: 'var(--text-muted)',
            fontFamily: 'var(--font-mono)',
          }}>
            {chunk.duration}m
          </div>
        </div>
      );
    };
    
    // Task Card
    const TaskCard = ({ task, onToggleChunk, onComplete }) => {
      const [isExpanded, setIsExpanded] = useState(false);
      const completedChunks = task.chunks.filter(c => c.completed).length;
      const progress = (completedChunks / task.chunks.length) * 100;
      const remainingTime = task.chunks.filter(c => !c.completed).reduce((sum, c) => sum + c.duration, 0);
      
      const handleChunkToggle = (chunkId) => {
        onToggleChunk(task.id, chunkId);
        
        const updatedChunks = task.chunks.map(c => 
          c.id === chunkId ? { ...c, completed: !c.completed } : c
        );
        if (updatedChunks.every(c => c.completed)) {
          setTimeout(() => onComplete(task.id), 300);
        }
      };
      
      return (
        <div style={{
          background: 'var(--bg-card)',
          borderRadius: 'var(--radius-lg)',
          padding: '20px',
          marginBottom: '12px',
          border: '1px solid var(--border-subtle)',
          transition: 'all 0.3s ease',
          animation: 'slideUp 0.4s ease',
        }}>
          <div 
            onClick={() => setIsExpanded(!isExpanded)}
            style={{ cursor: 'pointer' }}
          >
            <div style={{
              display: 'flex',
              alignItems: 'flex-start',
              justifyContent: 'space-between',
              marginBottom: '12px',
            }}>
              <div style={{ flex: 1 }}>
                <div style={{
                  fontSize: '11px',
                  fontWeight: '600',
                  color: 'var(--accent-primary)',
                  textTransform: 'uppercase',
                  letterSpacing: '0.5px',
                  marginBottom: '4px',
                }}>
                  {task.project}
                </div>
                <div style={{
                  fontSize: '16px',
                  fontWeight: '500',
                  color: 'var(--text-primary)',
                  lineHeight: 1.4,
                }}>
                  {task.name}
                </div>
              </div>
              <div style={{
                transform: isExpanded ? 'rotate(90deg)' : 'rotate(0deg)',
                transition: 'transform 0.2s ease',
                color: 'var(--text-muted)',
              }}>
                <Icons.ChevronRight />
              </div>
            </div>
            
            <div style={{
              display: 'flex',
              alignItems: 'center',
              gap: '16px',
              fontSize: '13px',
              color: 'var(--text-secondary)',
            }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                <Icons.Calendar />
                {getRelativeDay(task.deadline)}
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                <Icons.Clock />
                {remainingTime}m left
              </div>
              <div style={{
                marginLeft: 'auto',
                fontFamily: 'var(--font-mono)',
                fontSize: '12px',
                color: progress === 100 ? 'var(--accent-success)' : 'var(--text-muted)',
              }}>
                {completedChunks}/{task.chunks.length}
              </div>
            </div>
            
            <div style={{
              marginTop: '12px',
              height: '4px',
              background: 'var(--bg-elevated)',
              borderRadius: '2px',
              overflow: 'hidden',
            }}>
              <div style={{
                height: '100%',
                width: `${progress}%`,
                background: progress === 100 
                  ? 'var(--accent-success)' 
                  : 'linear-gradient(90deg, var(--accent-primary), var(--accent-glow))',
                borderRadius: '2px',
                transition: 'width 0.3s ease',
              }} />
            </div>
          </div>
          
          {isExpanded && (
            <div style={{
              marginTop: '16px',
              display: 'flex',
              flexDirection: 'column',
              gap: '8px',
              animation: 'fadeIn 0.3s ease',
            }}>
              <div style={{
                fontSize: '12px',
                fontWeight: '600',
                color: 'var(--text-muted)',
                textTransform: 'uppercase',
                letterSpacing: '0.5px',
                marginBottom: '4px',
                display: 'flex',
                alignItems: 'center',
                gap: '6px',
              }}>
                <Icons.Sparkles />
                AI-Chunked Steps
              </div>
              {task.chunks.map((chunk) => (
                <ChunkItem
                  key={chunk.id}
                  chunk={chunk}
                  onToggle={() => handleChunkToggle(chunk.id)}
                />
              ))}
            </div>
          )}
        </div>
      );
    };
    
    // Calendar View
    const CalendarView = ({ tasks, selectedDate, onDateSelect }) => {
      const getDaysOfWeek = () => {
        const days = [];
        const today = new Date();
        const startOfWeek = new Date(today);
        startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());
        
        for (let i = 0; i < 7; i++) {
          const day = new Date(startOfWeek);
          day.setDate(day.getDate() + i);
          days.push(day);
        }
        return days;
      };
      
      const days = getDaysOfWeek();
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const getTasksForDate = (date) => {
        return tasks.filter(task => {
          const taskDate = new Date(task.deadline);
          return taskDate.toDateString() === date.toDateString();
        });
      };
      
      return (
        <div style={{ marginBottom: '24px' }}>
          <div style={{
            display: 'flex',
            gap: '8px',
            overflowX: 'auto',
            paddingBottom: '8px',
          }}>
            {days.map((day, index) => {
              const isSelected = selectedDate && day.toDateString() === selectedDate.toDateString();
              const isCurrentDay = day.toDateString() === today.toDateString();
              const dayTasks = getTasksForDate(day);
              const hasIncompleteTasks = dayTasks.some(t => !t.completed);
              
              return (
                <button
                  key={index}
                  onClick={() => onDateSelect(day)}
                  style={{
                    flex: '1',
                    minWidth: '48px',
                    padding: '12px 8px',
                    background: isSelected 
                      ? 'linear-gradient(135deg, var(--accent-primary), var(--accent-glow))' 
                      : isCurrentDay 
                        ? 'var(--bg-elevated)' 
                        : 'var(--bg-card)',
                    border: isCurrentDay && !isSelected ? '1px solid var(--accent-primary)' : '1px solid var(--border-subtle)',
                    borderRadius: 'var(--radius-md)',
                    cursor: 'pointer',
                    transition: 'all 0.2s ease',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    gap: '4px',
                  }}
                >
                  <div style={{
                    fontSize: '11px',
                    fontWeight: '500',
                    color: isSelected ? 'white' : 'var(--text-muted)',
                    textTransform: 'uppercase',
                  }}>
                    {day.toLocaleDateString('en-US', { weekday: 'short' })}
                  </div>
                  <div style={{
                    fontSize: '18px',
                    fontWeight: '600',
                    color: isSelected ? 'white' : 'var(--text-primary)',
                  }}>
                    {day.getDate()}
                  </div>
                  {dayTasks.length > 0 && (
                    <div style={{
                      width: '6px',
                      height: '6px',
                      borderRadius: '50%',
                      background: isSelected 
                        ? 'white' 
                        : hasIncompleteTasks 
                          ? 'var(--accent-warning)' 
                          : 'var(--accent-success)',
                    }} />
                  )}
                </button>
              );
            })}
          </div>
        </div>
      );
    };
    
    // Quick Add Modal
    const QuickAddModal = ({ isOpen, onClose, onAdd, prefilledDate }) => {
      const [taskName, setTaskName] = useState('');
      const [project, setProject] = useState('');
      const inputRef = useRef(null);
      
      useEffect(() => {
        if (isOpen && inputRef.current) {
          inputRef.current.focus();
        }
      }, [isOpen]);
      
      if (!isOpen) return null;
      
      const handleSubmit = (e) => {
        e.preventDefault();
        if (!taskName.trim()) return;
        
        const deadline = prefilledDate || new Date();
        deadline.setHours(17, 0, 0, 0);
        
        const newTask = {
          id: generateId(),
          name: taskName,
          project: project || 'Inbox',
          deadline: deadline.toISOString(),
          chunks: generateTaskChunks(taskName),
          completed: false,
          createdAt: new Date().toISOString(),
        };
        
        onAdd(newTask);
        setTaskName('');
        setProject('');
        onClose();
      };
      
      return (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(13, 13, 20, 0.95)',
          zIndex: 100,
          display: 'flex',
          alignItems: 'flex-end',
          animation: 'fadeIn 0.2s ease',
        }}>
          <div style={{
            width: '100%',
            background: 'var(--bg-card)',
            borderRadius: 'var(--radius-xl) var(--radius-xl) 0 0',
            padding: '24px',
            paddingBottom: '40px',
            animation: 'slideUp 0.3s ease',
          }}>
            <div style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
              marginBottom: '20px',
            }}>
              <h3 style={{
                fontSize: '18px',
                fontWeight: '600',
                color: 'var(--text-primary)',
              }}>
                Quick Add Task
              </h3>
              <button
                onClick={onClose}
                style={{
                  background: 'none',
                  border: 'none',
                  color: 'var(--text-muted)',
                  cursor: 'pointer',
                  padding: '8px',
                }}
              >
                <Icons.X />
              </button>
            </div>
            
            <form onSubmit={handleSubmit}>
              <input
                ref={inputRef}
                type="text"
                value={taskName}
                onChange={(e) => setTaskName(e.target.value)}
                placeholder="What needs to be done?"
                style={{
                  width: '100%',
                  padding: '16px',
                  fontSize: '16px',
                  background: 'var(--bg-main)',
                  border: '1px solid var(--border-subtle)',
                  borderRadius: 'var(--radius-md)',
                  color: 'var(--text-primary)',
                  marginBottom: '12px',
                  outline: 'none',
                }}
              />
              
              <input
                type="text"
                value={project}
                onChange={(e) => setProject(e.target.value)}
                placeholder="Project (optional)"
                style={{
                  width: '100%',
                  padding: '16px',
                  fontSize: '16px',
                  background: 'var(--bg-main)',
                  border: '1px solid var(--border-subtle)',
                  borderRadius: 'var(--radius-md)',
                  color: 'var(--text-primary)',
                  marginBottom: '16px',
                  outline: 'none',
                }}
              />
              
              {prefilledDate && (
                <div style={{
                  fontSize: '14px',
                  color: 'var(--text-secondary)',
                  marginBottom: '16px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                }}>
                  <Icons.Calendar />
                  Scheduled for {formatDate(prefilledDate)}
                </div>
              )}
              
              <button
                type="submit"
                disabled={!taskName.trim()}
                style={{
                  width: '100%',
                  padding: '16px',
                  fontSize: '16px',
                  fontWeight: '600',
                  background: taskName.trim() 
                    ? 'linear-gradient(135deg, var(--accent-primary), var(--accent-glow))' 
                    : 'var(--bg-elevated)',
                  border: 'none',
                  borderRadius: 'var(--radius-md)',
                  color: taskName.trim() ? 'white' : 'var(--text-muted)',
                  cursor: taskName.trim() ? 'pointer' : 'not-allowed',
                  transition: 'all 0.2s ease',
                }}
              >
                Add Task
              </button>
            </form>
          </div>
        </div>
      );
    };
    
    // Bottom Navigation
    const BottomNav = ({ activeTab, onTabChange }) => {
      const tabs = [
        { id: 'today', icon: Icons.List, label: 'Today' },
        { id: 'calendar', icon: Icons.Calendar, label: 'Calendar' },
        { id: 'projects', icon: Icons.Folder, label: 'Projects' },
      ];
      
      return (
        <nav style={{
          display: 'flex',
          justifyContent: 'space-around',
          padding: '12px 16px',
          paddingBottom: '28px',
          background: 'var(--bg-card)',
          borderTop: '1px solid var(--border-subtle)',
        }}>
          {tabs.map((tab) => {
            const Icon = tab.icon;
            const isActive = activeTab === tab.id;
            
            return (
              <button
                key={tab.id}
                onClick={() => onTabChange(tab.id)}
                style={{
                  display: 'flex',
                  flexDirection: 'column',
                  alignItems: 'center',
                  gap: '4px',
                  padding: '8px 16px',
                  background: 'none',
                  border: 'none',
                  cursor: 'pointer',
                  color: isActive ? 'var(--accent-primary)' : 'var(--text-muted)',
                  transition: 'all 0.2s ease',
                }}
              >
                <Icon />
                <span style={{
                  fontSize: '11px',
                  fontWeight: isActive ? '600' : '400',
                }}>
                  {tab.label}
                </span>
              </button>
            );
          })}
        </nav>
      );
    };
    
    // Onboarding Screen
    const OnboardingScreen = ({ onStart }) => {
      return (
        <div style={{
          height: '100%',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          padding: '24px',
          textAlign: 'center',
          background: 'linear-gradient(180deg, var(--bg-deep) 0%, var(--bg-main) 100%)',
        }}>
          <div style={{
            width: '80px',
            height: '80px',
            borderRadius: '24px',
            background: 'linear-gradient(135deg, var(--accent-primary), var(--accent-glow))',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            marginBottom: '32px',
            boxShadow: 'var(--shadow-glow)',
            animation: 'float 3s ease-in-out infinite',
          }}>
            <Icons.Brain />
          </div>
          
          <h1 style={{
            fontSize: '32px',
            fontWeight: '700',
            color: 'var(--text-primary)',
            marginBottom: '12px',
            letterSpacing: '-0.5px',
          }}>
            NEURODONE
          </h1>
          
          <p style={{
            fontSize: '16px',
            color: 'var(--text-secondary)',
            marginBottom: '48px',
            maxWidth: '280px',
            lineHeight: 1.6,
          }}>
            Task management that works <em>with</em> your ADHD brain, not against it.
          </p>
          
          <div style={{
            display: 'flex',
            flexDirection: 'column',
            gap: '16px',
            width: '100%',
            maxWidth: '320px',
            marginBottom: '48px',
          }}>
            {[
              { icon: 'ðŸŽ¤', text: 'Voice-to-task with AI parsing' },
              { icon: 'ðŸ§©', text: 'Auto-chunks big tasks into small wins' },
              { icon: 'ðŸŽ¯', text: 'ADHD-friendly reminders' },
              { icon: 'âœ¨', text: 'Dopamine-preserving design' },
            ].map((feature, i) => (
              <div
                key={i}
                style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: '16px',
                  padding: '16px',
                  background: 'var(--bg-card)',
                  borderRadius: 'var(--radius-md)',
                  textAlign: 'left',
                  animation: `slideUp 0.4s ease ${i * 0.1}s both`,
                }}
              >
                <span style={{ fontSize: '24px' }}>{feature.icon}</span>
                <span style={{ fontSize: '14px', color: 'var(--text-primary)' }}>
                  {feature.text}
                </span>
              </div>
            ))}
          </div>
          
          <button
            onClick={onStart}
            style={{
              width: '100%',
              maxWidth: '320px',
              padding: '18px',
              fontSize: '16px',
              fontWeight: '600',
              background: 'linear-gradient(135deg, var(--accent-primary), var(--accent-glow))',
              border: 'none',
              borderRadius: 'var(--radius-lg)',
              color: 'white',
              cursor: 'pointer',
              boxShadow: 'var(--shadow-glow)',
              transition: 'all 0.3s ease',
            }}
          >
            Start 7-Day Free Trial
          </button>
          
          <p style={{
            fontSize: '12px',
            color: 'var(--text-muted)',
            marginTop: '16px',
          }}>
            No credit card required
          </p>
        </div>
      );
    };
    
    // Projects View
    const ProjectsView = ({ tasks }) => {
      const projects = {};
      tasks.forEach(task => {
        if (!projects[task.project]) {
          projects[task.project] = [];
        }
        projects[task.project].push(task);
      });
      
      return (
        <div style={{ padding: '20px' }}>
          <h2 style={{
            fontSize: '24px',
            fontWeight: '600',
            marginBottom: '20px',
            color: 'var(--text-primary)',
          }}>
            Projects
          </h2>
          
          {Object.keys(projects).length === 0 ? (
            <div style={{
              textAlign: 'center',
              padding: '40px 20px',
              color: 'var(--text-muted)',
            }}>
              <Icons.Folder />
              <p style={{ marginTop: '12px' }}>No projects yet</p>
              <p style={{ fontSize: '14px' }}>Add a task to get started!</p>
            </div>
          ) : (
            Object.entries(projects).map(([projectName, projectTasks]) => {
              const completedCount = projectTasks.filter(t => t.completed).length;
              const progress = (completedCount / projectTasks.length) * 100;
              
              return (
                <div
                  key={projectName}
                  style={{
                    background: 'var(--bg-card)',
                    borderRadius: 'var(--radius-lg)',
                    padding: '20px',
                    marginBottom: '12px',
                    border: '1px solid var(--border-subtle)',
                  }}
                >
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'space-between',
                    marginBottom: '12px',
                  }}>
                    <h3 style={{
                      fontSize: '16px',
                      fontWeight: '600',
                      color: 'var(--text-primary)',
                    }}>
                      {projectName}
                    </h3>
                    <span style={{
                      fontSize: '13px',
                      color: 'var(--text-muted)',
                      fontFamily: 'var(--font-mono)',
                    }}>
                      {completedCount}/{projectTasks.length}
                    </span>
                  </div>
                  
                  <div style={{
                    height: '4px',
                    background: 'var(--bg-elevated)',
                    borderRadius: '2px',
                    overflow: 'hidden',
                  }}>
                    <div style={{
                      height: '100%',
                      width: `${progress}%`,
                      background: progress === 100 
                        ? 'var(--accent-success)' 
                        : 'linear-gradient(90deg, var(--accent-primary), var(--accent-glow))',
                      borderRadius: '2px',
                      transition: 'width 0.3s ease',
                    }} />
                  </div>
                </div>
              );
            })
          )}
        </div>
      );
    };

    // Main App
    const App = () => {
      const [isOnboarded, setIsOnboarded] = useState(() => {
        return localStorage.getItem('neurodone_onboarded') === 'true';
      });
      const [tasks, setTasks] = useState(() => {
        const saved = localStorage.getItem('neurodone_tasks');
        return saved ? JSON.parse(saved) : [];
      });
      const [activeTab, setActiveTab] = useState('today');
      const [selectedDate, setSelectedDate] = useState(new Date());
      const [showQuickAdd, setShowQuickAdd] = useState(false);
      const [showCelebration, setShowCelebration] = useState(false);
      
      useEffect(() => {
        localStorage.setItem('neurodone_tasks', JSON.stringify(tasks));
      }, [tasks]);
      
      const handleVoiceTask = (task) => {
        setTasks(prev => [task, ...prev]);
      };
      
      const handleAddTask = (task) => {
        setTasks(prev => [task, ...prev]);
      };
      
      const handleToggleChunk = (taskId, chunkId) => {
        setTasks(prev => prev.map(task => {
          if (task.id === taskId) {
            return {
              ...task,
              chunks: task.chunks.map(chunk => 
                chunk.id === chunkId 
                  ? { ...chunk, completed: !chunk.completed }
                  : chunk
              ),
            };
          }
          return task;
        }));
      };
      
      const handleCompleteTask = (taskId) => {
        setShowCelebration(true);
        setTasks(prev => prev.map(task => 
          task.id === taskId ? { ...task, completed: true } : task
        ));
      };
      
      const handleStartTrial = () => {
        localStorage.setItem('neurodone_onboarded', 'true');
        setIsOnboarded(true);
      };
      
      const todayTasks = tasks.filter(task => {
        const taskDate = new Date(task.deadline);
        const today = new Date();
        return taskDate.toDateString() === today.toDateString() || 
               (taskDate < today && !task.completed);
      });
      
      const calendarTasks = tasks.filter(task => {
        const taskDate = new Date(task.deadline);
        return taskDate.toDateString() === selectedDate.toDateString();
      });
      
      if (!isOnboarded) {
        return <OnboardingScreen onStart={handleStartTrial} />;
      }
      
      return (
        <div style={{
          height: '100%',
          display: 'flex',
          flexDirection: 'column',
          background: 'var(--bg-main)',
        }}>
          <header style={{
            padding: '16px 20px',
            paddingTop: '48px',
            background: 'var(--bg-deep)',
            borderBottom: '1px solid var(--border-subtle)',
          }}>
            <div style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
            }}>
              <div>
                <div style={{
                  fontSize: '12px',
                  color: 'var(--text-muted)',
                  fontFamily: 'var(--font-mono)',
                  marginBottom: '4px',
                }}>
                  {new Date().toLocaleDateString('en-US', { 
                    weekday: 'long',
                    month: 'short',
                    day: 'numeric',
                  })}
                </div>
                <h1 style={{
                  fontSize: '24px',
                  fontWeight: '700',
                  color: 'var(--text-primary)',
                }}>
                  {activeTab === 'today' && 'Today'}
                  {activeTab === 'calendar' && 'Calendar'}
                  {activeTab === 'projects' && 'Projects'}
                </h1>
              </div>
              
              <div style={{
                display: 'flex',
                alignItems: 'center',
                gap: '12px',
              }}>
                {todayTasks.filter(t => !t.completed).length > 0 && (
                  <div style={{
                    padding: '6px 12px',
                    background: 'var(--bg-card)',
                    borderRadius: 'var(--radius-sm)',
                    fontSize: '13px',
                    color: 'var(--text-secondary)',
                  }}>
                    <span style={{ color: 'var(--accent-primary)', fontWeight: '600' }}>
                      {todayTasks.filter(t => !t.completed).length}
                    </span>
                    {' '}tasks
                  </div>
                )}
              </div>
            </div>
          </header>
          
          <main style={{
            flex: 1,
            overflow: 'auto',
            padding: activeTab === 'projects' ? '0' : '20px',
          }}>
            {activeTab === 'today' && (
              <>
                {todayTasks.length === 0 ? (
                  <div style={{
                    textAlign: 'center',
                    padding: '60px 20px',
                  }}>
                    <div style={{ fontSize: '48px', marginBottom: '16px' }}>ðŸŽ‰</div>
                    <h2 style={{
                      fontSize: '20px',
                      fontWeight: '600',
                      color: 'var(--text-primary)',
                      marginBottom: '8px',
                    }}>
                      All clear!
                    </h2>
                    <p style={{
                      fontSize: '14px',
                      color: 'var(--text-secondary)',
                      marginBottom: '24px',
                    }}>
                      No tasks for today. Enjoy your freedom!
                    </p>
                    <p style={{
                      fontSize: '13px',
                      color: 'var(--text-muted)',
                    }}>
                      Tap the mic below to add a task by voice
                    </p>
                  </div>
                ) : (
                  todayTasks.map((task) => (
                    <TaskCard
                      key={task.id}
                      task={task}
                      onToggleChunk={handleToggleChunk}
                      onComplete={handleCompleteTask}
                    />
                  ))
                )}
              </>
            )}
            
            {activeTab === 'calendar' && (
              <>
                <CalendarView
                  tasks={tasks}
                  selectedDate={selectedDate}
                  onDateSelect={setSelectedDate}
                />
                
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'space-between',
                  marginBottom: '16px',
                }}>
                  <h2 style={{
                    fontSize: '16px',
                    fontWeight: '600',
                    color: 'var(--text-primary)',
                  }}>
                    {getRelativeDay(selectedDate)}
                  </h2>
                  <button
                    onClick={() => setShowQuickAdd(true)}
                    style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '6px',
                      padding: '8px 12px',
                      background: 'var(--bg-card)',
                      border: '1px solid var(--border-subtle)',
                      borderRadius: 'var(--radius-sm)',
                      color: 'var(--text-secondary)',
                      fontSize: '13px',
                      cursor: 'pointer',
                    }}
                  >
                    <Icons.Plus />
                    Add
                  </button>
                </div>
                
                {calendarTasks.length === 0 ? (
                  <div style={{
                    textAlign: 'center',
                    padding: '40px 20px',
                    color: 'var(--text-muted)',
                  }}>
                    <p>No tasks scheduled</p>
                    <p style={{ fontSize: '14px', marginTop: '8px' }}>
                      Tap + to add one
                    </p>
                  </div>
                ) : (
                  calendarTasks.map((task) => (
                    <TaskCard
                      key={task.id}
                      task={task}
                      onToggleChunk={handleToggleChunk}
                      onComplete={handleCompleteTask}
                    />
                  ))
                )}
              </>
            )}
            
            {activeTab === 'projects' && (
              <ProjectsView tasks={tasks} />
            )}
          </main>
          
          <div style={{
            position: 'fixed',
            bottom: '100px',
            left: '50%',
            transform: 'translateX(-50%)',
            zIndex: 50,
          }}>
            <VoiceButton onTranscript={handleVoiceTask} />
          </div>
          
          <BottomNav activeTab={activeTab} onTabChange={setActiveTab} />
          
          <QuickAddModal
            isOpen={showQuickAdd}
            onClose={() => setShowQuickAdd(false)}
            onAdd={handleAddTask}
            prefilledDate={activeTab === 'calendar' ? selectedDate : null}
          />
          
          <Celebration
            show={showCelebration}
            onComplete={() => setShowCelebration(false)}
          />
          
          <style>{`
            @keyframes fadeIn {
              from { opacity: 0; }
              to { opacity: 1; }
            }
            
            @keyframes slideUp {
              from { 
                opacity: 0;
                transform: translateY(20px);
              }
              to { 
                opacity: 1;
                transform: translateY(0);
              }
            }
            
            @keyframes popIn {
              from {
                opacity: 0;
                transform: scale(0.8);
              }
              to {
                opacity: 1;
                transform: scale(1);
              }
            }
            
            @keyframes pulse {
              0%, 100% { transform: scale(1.1); }
              50% { transform: scale(1.15); }
            }
            
            @keyframes spin {
              to { transform: rotate(360deg); }
            }
            
            @keyframes float {
              0%, 100% { transform: translateY(0); }
              50% { transform: translateY(-10px); }
            }
          `}</style>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
